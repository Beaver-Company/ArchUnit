<?xml version="1.0" encoding="UTF-8"?>
<FindBugsFilter>
    <Match>
        <Or>
            <!-- Null is not used as a value (return or input) in any method, so we don't need @Nullable and co. -->
            <Bug pattern="NP_PARAMETER_MUST_BE_NONNULL_BUT_MARKED_AS_NULLABLE"/>
            <!-- We don't use Java serialization, so we don't want to be forced to add serialVersionUuid to fields of enums, etc. -->
            <Bug pattern="SE_BAD_FIELD"/>
        </Or>
    </Match>
    <Match>
        <!-- The respective methods add URLClassLoaders to a set, not URLs. I don't see any equals or hashCode that
             would delegate to URL either, so this seems like a false positive -->
        <Bug pattern="DMI_COLLECTION_OF_URLS"/>
        <Or>
            <Method name="findAllUrlClassLoadersInContext"/>
            <Method name="findUrlClassLoadersInHierarchy"/>
        </Or>
    </Match>
    <Match>
        <!-- False positive on try-with-resources statement with JDK-11?
            Nullcheck of in at line 189 of value previously dereferenced in com.tngtech.archunit.core.domain.Source$Md5sum.read(URI)
            Bug type RCN_REDUNDANT_NULLCHECK_WOULD_HAVE_BEEN_A_NPE
            In class com.tngtech.archunit.core.domain.Source$Md5sum
            In method com.tngtech.archunit.core.domain.Source$Md5sum.read(URI)
            Value loaded from in
            Return value of java.net.URL.openStream() of type java.io.InputStream
            At Source.java:[line 189]
            Redundant null check at Source.java:[line 190]
        -->
        <Class name="com.tngtech.archunit.core.domain.Source$Md5sum"/>
        <Method name="read"/>
        <Bug pattern="RCN_REDUNDANT_NULLCHECK_WOULD_HAVE_BEEN_A_NPE"/>
    </Match>
    <Match>
        <!-- False positive on try-with-resources statement with JDK-11?
            Redundant nullcheck of inputStream, which is known to be non-null in com.tngtech.archunit.ArchConfiguration.readProperties(String)
            Bug type RCN_REDUNDANT_NULLCHECK_OF_NONNULL_VALUE
            In class com.tngtech.archunit.ArchConfiguration
            In method com.tngtech.archunit.ArchConfiguration.readProperties(String)
            Value loaded from inputStream
            Return value of Class.getResourceAsStream(String) of type java.io.InputStream
            Redundant null check at ArchConfiguration.java:[line 88]
        -->
        <Class name="com.tngtech.archunit.ArchConfiguration"/>
        <Method name="readProperties"/>
        <Bug pattern="RCN_REDUNDANT_NULLCHECK_OF_NONNULL_VALUE"/>
    </Match>
    <Match>
        <!-- False positive on try-with-resources statement with JDK-9 and JDK-10 (https://github.com/TNG/ArchUnit/issues/199):
             In method com.tngtech.archunit.library.freeze.ViolationStoreFactory$TextFileBasedViolationStore$FileSyncedProperties.loadRulesFrom(File)
             Reference type java.io.InputStream
             1 instances of obligation remaining
             Obligation to clean up resource created at ViolationStoreFactory.java:[line 192] is not discharged
        -->
        <Class name="com.tngtech.archunit.library.freeze.ViolationStoreFactory$TextFileBasedViolationStore$FileSyncedProperties"/>
        <Method name="loadRulesFrom"/>
        <Bug pattern="OBL_UNSATISFIED_OBLIGATION"/>
    </Match>
    <Match>
        <!-- False positive on try-with-resources statement with JDK-9 and JDK-10 (https://github.com/TNG/ArchUnit/issues/199):
             In method com.tngtech.archunit.library.freeze.ViolationStoreFactory$TextFileBasedViolationStore$FileSyncedProperties.syncFileSystem()
             Reference type java.io.OutputStream
             1 instances of obligation remaining
             Obligation to clean up resource created at ViolationStoreFactory.java:[line 214] is not discharged
        -->
        <Class name="com.tngtech.archunit.library.freeze.ViolationStoreFactory$TextFileBasedViolationStore$FileSyncedProperties"/>
        <Method name="syncFileSystem"/>
        <Bug pattern="OBL_UNSATISFIED_OBLIGATION"/>
    </Match>
    <Match>
        <!-- exclude these methods from the bug-check OBL_UNSATISFIED_OBLIGATION, as a false positive warning would be
             created (because of using of try-with-resources-statement in Java 9) -->
        <Class name="com.tngtech.archunit.visual.Visualizer"/>
        <Or>
            <Method name="exportJson"
                    params="com.tngtech.archunit.core.domain.JavaClasses, java.io.File"
                    returns="void"/>
            <Method name="exportViolations"
                    params="java.io.File, java.lang.String, com.tngtech.archunit.lang.EvaluationResult" returns="void"/>
        </Or>
        <Bug code="OBL"/>
    </Match>
    <Match>
        <!-- exclude these fields, as they are marked as unread, but they are read by Gson through the annotations -->
        <Class name="com.tngtech.archunit.visual.JsonAccess"/>
        <Or>
            <Field name="target"/>
            <Field name="startCodeUnit"/>
            <Field name="targetCodeElement"/>
        </Or>
        <Bug code="UrF"/>
    </Match>
    <Match>
        <Class name="com.tngtech.archunit.visual.JsonJavaClass"/>
        <Or>
            <Field name="superclass"/>
        </Or>
        <Bug code="UrF"/>
    </Match>
    <!--FIXME: remove this exclusion-->
    <Match>
        <Class name="com.tngtech.archunit.visual.JsonJavaElement"/>
        <Or>
            <Field name="anonymousImplementation"/>
        </Or>
        <Bug code="UrF"/>
    </Match>
    <Match>
        <Class name="com.tngtech.archunit.visual.JsonElement"/>
        <Or>
            <Field name="type"/>
        </Or>
        <Bug code="UrF"/>
    </Match>
    <Match>
        <Class name="com.tngtech.archunit.visual.JsonEvaluationResult"/>
        <Or>
            <Field name="rule"/>
            <Field name="violations"/>
        </Or>
        <Bug code="UrF"/>
    </Match>
    <Match>
        <Class name="com.tngtech.archunit.visual.JsonViolation"/>
        <Or>
            <Field name="origin"/>
            <Field name="target"/>
        </Or>
        <Bug code="UrF"/>
    </Match>
    <Match>
        <Class name="com.tngtech.archunit.visual.JsonExport"/>
        <Or>
            <Field name="root"/>
            <Field name="dependencies"/>
        </Or>
        <Bug code="UrF"/>
    </Match>
    <Match>
        <Class name="com.tngtech.archunit.visual.JsonJavaDependency"/>
        <Or>
            <Field name="description"/>
            <Field name="originClass"/>
            <Field name="targetClass"/>
            <Field name="type"/>
        </Or>
        <Bug code="UrF"/>
    </Match>
</FindBugsFilter>
